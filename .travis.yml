language: minimal

env:
  global:
  - PYENV=py37
  # Encrypted values for MESSAGE_IX_CI_USER, MESSAGE_IX_CI_PW
  - secure: "Hwgf9u/oxhrw2daXxo8DQxKfpgcqDHndOG0RxiRVONQK2K6Yq4VVNAnuEhMIjubumf3TQMfMnK8pspMzhRuaV00KTWcXV2J2tIitL4c/mQC1Kw4JJsPd9zK1A28Ot4uWRHy+sf8fFBFoiPQDv098imXJhZFniIi+PVzAPA2P6aRfXvMe5ebJkcO7wf08xA9ky6+ojYcajx1Yz05vZ/pevTVum2aXyaBnJAIOAZC1MF5XIZYMUGr0kWi4InryuIAXx9CAheNXJD1xBCp1t+bnpjsh+ELKEgWHdtVUhxyzMkt7/Tiy31tkqL4QtXcSQw6FeRU4zJ0CiIyk5896Q7aSjuJmNcxXs5wqf69e/KrkNIJmvE5Y6uidd2NqBcWQnh6A/YqDQIEBHCVZ/pfzqullRld2GSE+nq3Z5K/Skq/GW0n3IL8GFf8EjGCzVYudbDU6kTL/uLjWdbgTBU25seTbdY+FklLQAWVJ1tFCCp8eaq2NNknmgNrTCKkesROndod92JLShSUtRw9A6I+JcygfMJpG7L8IouDXeFTWXbcSgADdrPJj6y9Ht2d5R8R3NOPgmqYkaZiuA10g8jvuRoYZWnbQNaipX01H3nufAaem25ZowiJwlRY+ZHqZJQBXI93xpDhkZ0skLlOOzJBGlQFYf8MCol2AvIzO1z3l1HSWM1k="

os:
- linux
- osx
# Turn this on once Travis Windows support improves
# - windows

cache:
  # Travis ensures these directories are created if they do not already exist
  directories:
  # - $HOME/miniconda/pkgs  # see https://github.com/iiasa/message_ix/pull/295
  - $HOME/.conda/pkgs
  - $HOME/.cache/message_ix

addons:
  apt:
    packages:
    - graphviz
  homebrew:
    packages:
    - graphviz

before_install:
  # Set other environment variables
  - . ci/env.sh
  # Download GAMS and Miniconda
  - . ci/travis-before_install.sh

install:
  # Install GAMS, conda, and Python dependencies needed for testing
  - . ci/travis-install.sh
  # Install the Python package
  - pip install --editable .[reporting,tests,tutorial]

script:
  - python -c "import os, sys; assert os.environ['PYVERSION'] == sys.version[0]"
  # Run tests
  - pytest --verbose message_ix --cov-report=xml
  # Test that documentation can be built
  - cd doc
  - pip install -r requirements.txt
  - make html

after_success:
  - codecov
